# Tricky Lock
Исходный код Tricky Lock для удобства восприятия.
```cpp
void Lock()
  while (thread_count_.fetch_add(1) > 0)
    thread_count_.fetch_sub(1); // (*)

void Unlock()
  thread_count_.fetch_sub(1);
```
Ниже приведён пример бесконечного захвата свободного лока двумя потоками. Как и указано в условии, "нас не беспокоит реалистичность поведения планировщика в таком исполнении".

| Tread 1 | Thread 2 |
|--------|--------|
|Поток захватывает лок.|прерывание|
|прерывание|Пытается захватить лок, входит в цикл, останавливается перед (*). `thread_count` равен 1.|
|Поток освобождает лок. Пытается захватить опять. `thread_count` больше 0, заходит в цикл, останавливается перед (*). |прерывание|
|прерывание|Совершает итерацию. Так как `thread_count` больше 0, он заходит в цикл. Останавливается перед (*).|
|Совершает итерацию. Так как `thread_count` больше 0, он заходит в цикл. Останавливается перед (*).|прерывание|

Последние две строки итерируются бесконечно долго при свободном локе.
